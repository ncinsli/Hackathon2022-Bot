#№ School bells v2 | Beller Bot | BridgeBell146

Система управления школьными звонками
Полностью управляется из Telegram

## Запуск

```git clone https://github.com/school146/school-bells-v2/
pip3 install pyTelegramBotApi
pip3 install smbus2
export BELLER_TOKEN=токен # ОПЦИОНАЛЬНО
screen -dmS bells python3 main.py
```
# Команды

<Х> обозначает опциональность аргумента Х -- при отсутствии он запомлняется аргументом по умолчанию

Для не-администраторов доступна команда
**/get_timetable** - Расписание звонков 

Для администраторов доступны команды:

**/ring** - Вызвать звонок вручную

**/add_admin** - Добавить администратора

**/rm_admin** - Удалить администратора

**/pre_ring_edit** - Изменить интервал между предзвонком и основным звонком (в секундах)

**/lesson_duration** - Изменить длину уроков [TODO]

**/break_duration** - Изменить длину перемен [TODO]

**/shift <dd.mm.yyyy> +-(int)(min/h)** - Сдвинуть всё расписание
    
    Пример: /shift 26.12.2022 +10min    Сдвинуть расписание 26-го декабря на 10 минут вперед 
            /shift -1h                  Сдвинуть расписание сегодня на час назад

**/resize <dd.mm.yyyy> lesson/break int +-int(h/min)** - Изменение длины конкретной перемены или конкретного урока в конкретный день (по правой границе)
    
    Пример: /resize 26.12.2022 break 1 +10min.    Сделать первую перемену 26 декадгя длиннее на 10 минут   
            /resize lesson 2 -5min.               Сделать второй урок короче на пять минут

**/mute <dd.mm.yyyy> hh:mm** - Заглушить звонок, который должен произвенеть в заданное время
   
    Пример: /mute 01.12.2022 9:45.   Заглушить звонок в 09:45 1 декабря 2022 года
            /mute 10:40**.             Заглушить звонок в 10:40   

    
**/unmute <dd.mm.yyyy> hh:mm** - Действие, обратное **/mute**

    Пример: /unmute 01.12.2022 9:45.   Убрать глушение с звонка в 09:45 1 декабря 2022 года
            /unmute 10:40**.             Убрать глушение с звонка в 10:40   

**/set_timetable** - Установка расписания из JSON

**/mute_all <dd.mm.yyyy>** - Заглушить все звонки на определенный день
**/unmute_all <dd.mm.yyyy>** - Убрать глушение со всех звонков на сегодняшний день

# Архитектура

main.py - Точка входа, обработчик команд с валидацией

timetable.middleware - промежуточный слой, группа функций, которые обрабатывают сообщения с командами по управлению расписанием, занимаются декомпозицией на аргументы и вызовом функций по управлению БД
admins.middleware - то же, но обрабатывает сообщения с командами по управлению привилегиями

timetable.(shifting, resizing...) - слой по управлению БД с информацией о расписании
admins.(edit, storage, validator etc.) - слой по управлению БД с информацией об адиминах
        
daemon - Фоновый процесс, отвечающий за то, чтобы звонить по временамм из БД
   
   .update(...) вызывается, когда расписание меняется во время работы, а так же на старте демона
    
  
configuration.py - статические переменные и конфигурационная информация
